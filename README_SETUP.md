# Установка LightCrypto GUI

Графический интерфейс для криптографической системы LightCrypto с двумя независимыми приложениями на Python + tkinter.

## 🚀 Быстрый старт

### 1. Настройка sudo доступа
```bash
bash setup_sudo.sh
```

### 2. Сборка проекта (если не собран)
```bash
mkdir -p build
cd build
cmake ..
make
cd ..
```

### 3. Запуск GUI
```bash
# Запуск интерфейса расшифровки (в фоне)
python3 decrypt_gui.py &

# Запуск интерфейса шифрования
python3 encrypt_gui.py
```

## 📋 Описание файлов

### GUI приложения
- **`encrypt_gui.py`** - Интерфейс для шифрования данных (неймспейс ns1)
- **`decrypt_gui.py`** - Интерфейс для расшифровки данных (неймспейс ns2)

### Служебные файлы
- **`setup_sudo.sh`** - Скрипт настройки sudo доступа без пароля
- **`README_SETUP.md`** - Данная инструкция

## 🔧 Настройка неймспейсов

Если неймспейсы ns1 и ns2 не настроены, выполните:

```bash
# Создание неймспейсов
sudo ip netns add ns1
sudo ip netns add ns2

# Создание TAP интерфейсов
sudo ip tuntap add tap0 mode tap
sudo ip tuntap add tap1 mode tap

# Назначение интерфейсов в неймспейсы
sudo ip link set tap0 netns ns1
sudo ip link set tap1 netns ns2

# Настройка IP адресов
sudo ip netns exec ns1 ip addr add 192.168.1.1/24 dev tap0
sudo ip netns exec ns2 ip addr add 192.168.1.2/24 dev tap1

# Активация интерфейсов
sudo ip netns exec ns1 ip link set tap0 up
sudo ip netns exec ns2 ip link set tap1 up
```

## 🖥️ Интерфейс

### Окно encrypt_gui.py
```
┌─────────────────────────────────┐
│           encrypt               │
├─────────────────────────────────┤
│     [Запустить задачу]          │
├─────────────────────────────────┤
│ ┌─ Консоль ─────────────────────┐ │
│ │ 🚀 Запуск команды:            │ │
│ │ sudo ip netns exec ns1        │ │
│ │ ./build/tap_encrypt 192.168.1.2│ │
│ │ 12345                         │ │
│ │ 🌐 Используем IP: 192.168.1.2,│ │
│ │    порт: 12345                │ │
│ │ ✅ IP-адрес доступен          │ │
│ │ 📡 tap0 открыт для чтения     │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────┤
│ Введите IP. По умолчанию 127.0.0.1│
│ [192.168.1.2            ]      │
│ Введите порт. По умолчанию 12345│
│ [12345                  ]      │
│ ☐ Режим передачи текстовых      │
│   сообщений                     │
└─────────────────────────────────┘
```

### Окно decrypt_gui.py
```
┌─────────────────────────────────┐
│           decrypt               │
├─────────────────────────────────┤
│     [Запустить задачу]          │
├─────────────────────────────────┤
│ ┌─ Консоль ─────────────────────┐ │
│ │ 🚀 Запуск команды:            │ │
│ │ sudo ip netns exec ns2        │ │
│ │ ./build/tap_decrypt 12345     │ │
│ │ 🌐 Ожидаем пакеты на IP:      │ │
│ │    0.0.0.0, порт: 12345       │ │
│ │ 📡 tap1 открыт для записи     │ │
│ │ ✅ Принят и расшифрован кадр  │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────┤
│ Введите IP. По умолчанию 0.0.0.0│
│ [192.168.1.2            ]      │
│ Введите порт. По умолчанию 12345│
│ [12345                  ]      │
│ ☐ Режим приема текстовых        │
│   сообщений                     │
└─────────────────────────────────┘
```

## 🔐 Безопасность

### Права sudo
Скрипт `setup_sudo.sh` настраивает следующие права без запроса пароля:
- `sudo ip netns exec ns1/ns2 ./build/tap_encrypt/tap_decrypt`
- `sudo ip netns` (все операции с неймспейсами)
- `sudo killall tap_encrypt/tap_decrypt`

### Файл конфигурации
Создается файл `/etc/sudoers.d/lightcrypto` с правилами доступа.

## 🛠️ Устранение неполадок

### Проблема: GUI запрашивает пароль
**Решение:**
```bash
bash setup_sudo.sh
```

### Проблема: Файл ./build/tap_encrypt не найден
**Решение:**
```bash
mkdir -p build && cd build && cmake .. && make && cd ..
```

### Проблема: Неймспейсы не найдены
**Решение:** Выполните настройку неймспейсов (см. раздел "Настройка неймспейсов")

### Проблема: Ошибка bind() в decrypt_gui
**Решение:** Убедитесь, что порт не занят другим процессом:
```bash
sudo netstat -tulpn | grep :12345
sudo killall tap_decrypt  # если процесс висит
```

### Проблема: Не удается подключиться между encrypt и decrypt
**Решение:**
1. Убедитесь, что decrypt_gui запущен первым (слушает порт)
2. Проверьте IP адреса в настройках
3. Убедитесь, что неймспейсы настроены корректно

## 📖 Дополнительные команды

### Проверка состояния неймспейсов
```bash
sudo ip netns list
sudo ip netns exec ns1 ip addr show
sudo ip netns exec ns2 ip addr show
```

### Очистка неймспейсов
```bash
sudo ip netns delete ns1
sudo ip netns delete ns2
```

### Проверка процессов
```bash
ps aux | grep tap_
sudo netstat -tulpn | grep :12345
```

## 🎯 Режимы работы

### Режим Ethernet-кадров (по умолчанию)
- Шифрует/расшифровывает сетевые кадры между tap интерфейсами
- Используется для создания защищенного туннеля

### Режим текстовых сообщений (--msg)
- Включается чекбоксом "Режим передачи/приема текстовых сообщений"
- Позволяет отправлять и получать текстовые сообщения
- В encrypt_gui: вводите текст в консоли после запуска
- В decrypt_gui: получаемые сообщения отображаются в консоли

## 📞 Поддержка

При возникновении проблем:
1. Проверьте вывод в консоли GUI
2. Убедитесь, что sudo права настроены (`bash setup_sudo.sh`)
3. Проверьте, что проект собран (`make` в папке build)
4. Убедитесь, что неймспейсы настроены корректно
