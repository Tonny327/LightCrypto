#!/bin/bash
# ะกะพะทะดะฐะฝะธะต ะธ ะฝะฐัััะพะนะบะฐ tap0 ะฝะฐ ะบะพะผะฟัััะตัะต A

# ะะฐัะฐะผะตััั ะฟะพ ัะผะพะปัะฐะฝะธั
TAP_A_IP="${1:-10.0.0.1/24}"

echo "๐ง ะกะพะทะดะฐะฝะธะต ะธ ะฝะฐัััะพะนะบะฐ tap0 ะฝะฐ ะบะพะผะฟัััะตัะต A..."
echo "   IP ะฐะดัะตั: $TAP_A_IP"

# ะฃะดะฐะปัะตะผ ััะฐััะน ะธะฝัะตััะตะนั, ะตัะปะธ ัััะตััะฒัะตั
if ip link show tap0 &>/dev/null; then
    echo "  โ ะฃะดะฐะปะตะฝะธะต ััะฐัะพะณะพ tap0..."
    sudo ip link delete tap0 2>/dev/null || true
fi

# ะกะพะทะดะฐะตะผ ะธะฝัะตััะตะนั
echo "  โ ะกะพะทะดะฐะฝะธะต tap0..."
sudo ip tuntap add dev tap0 mode tap user $USER
if [ $? -ne 0 ]; then
    echo "โ ะัะธะฑะบะฐ ัะพะทะดะฐะฝะธั tap0!"
    exit 1
fi

echo "โ tap0 ัะพะทะดะฐะฝ"

# ะัะบะปััะฐะตะผ IPv6 (ััะพะฑั ะฝะต ะผะตัะฐะป)
echo "  โ ะัะบะปััะตะฝะธะต IPv6 ะฝะฐ tap0..."
sudo sysctl -w net.ipv6.conf.tap0.disable_ipv6=1 >/dev/null 2>&1

# ะะพะดะฝะธะผะฐะตะผ ะธะฝัะตััะตะนั
echo "  โ ะะพะดะฝััะธะต ะธะฝัะตััะตะนัะฐ tap0..."
sudo ip link set tap0 up

# ะะฐะทะฝะฐัะฐะตะผ IP-ะฐะดัะตั
echo "  โ ะะฐะทะฝะฐัะตะฝะธะต IP-ะฐะดัะตัะฐ $TAP_A_IP..."
sudo ip addr add $TAP_A_IP dev tap0 2>/dev/null

echo ""
echo "โ ะะฐัััะพะนะบะฐ ะทะฐะฒะตััะตะฝะฐ!"
echo ""
echo "๐ ะกัะฐััั tap0:"
ip addr show tap0

echo ""
echo "๐งช ะะพะถะตัะต ะฟัะพะฒะตัะธัั ping:"
echo "   ping 10.0.0.2 (ะฟะพ ัะผะพะปัะฐะฝะธั))"

