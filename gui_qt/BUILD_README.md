# Сборка исполняемого файла LightCrypto GUI

Это руководство описывает процесс сборки исполняемого файла для графического интерфейса LightCrypto (PyQt6 версия).

## Требования

- Python 3.8 или выше
- PyQt6
- PyInstaller
- Собранные исполняемые файлы проекта (`tap_encrypt`, `tap_decrypt`)

## Быстрая сборка

1. **Убедитесь, что проект собран:**
   ```bash
   cd /home/tonny/projects/MyCryptoProject/LightCrypto
   mkdir -p build
   cd build
   cmake ..
   make
   ```

2. **Установите python3-venv (если еще не установлен):**
   ```bash
   sudo apt-get install python3-venv
   ```
   
   **Примечание:** Скрипт сборки автоматически создаст виртуальное окружение и установит все зависимости. Вам не нужно устанавливать зависимости вручную!

3. **Запустите скрипт сборки:**
   ```bash
   ./build_executable.sh
   ```

4. **Исполняемый файл будет создан в:**
   ```
   gui_qt/dist/lightcrypto
   ```

## Ручная сборка

Если вы хотите собрать вручную:

```bash
cd gui_qt
python3 -m PyInstaller --clean --noconfirm lightcrypto.spec
```

## Что включается в исполняемый файл

- Все Python модули приложения
- Исполняемые файлы `tap_encrypt` и `tap_decrypt` из `build/`
- CSV файлы из директории `CipherKeys/`
- Скрипты настройки TAP интерфейсов (`setup_tap_*.sh`)

## Структура после сборки

```
gui_qt/
├── dist/
│   └── lightcrypto          # Исполняемый файл
├── build/                    # Временные файлы PyInstaller
└── lightcrypto.spec         # Конфигурация PyInstaller
```

## Запуск исполняемого файла

```bash
./dist/lightcrypto
```

## Устранение проблем

### Ошибка: "tap_encrypt не найден"

Убедитесь, что проект собран:
```bash
cd /home/tonny/projects/MyCryptoProject/LightCrypto/build
make
```

### Ошибка: "externally-managed-environment"

Скрипт сборки автоматически использует виртуальное окружение, поэтому эта ошибка не должна возникать. Если она появилась, убедитесь, что используете обновленный скрипт `build_executable.sh`.

### Ошибка: "Модуль venv не доступен"

Установите python3-venv:
```bash
sudo apt-get install python3-venv
```

### Ошибка: "PyQt6 не установлен"

Скрипт автоматически установит все зависимости в виртуальное окружение. Если ошибка все же возникает, проверьте, что скрипт имеет права на выполнение: `chmod +x build_executable.sh`

### Ошибка при запуске исполняемого файла

1. Проверьте, что все зависимости установлены
2. Убедитесь, что исполняемые файлы `tap_encrypt` и `tap_decrypt` существуют
3. Проверьте права доступа: `chmod +x dist/lightcrypto`

### Ошибка: "libQt6Gui.so.6: cannot open shared object file"

Установите системные библиотеки Qt6:
```bash
# Ubuntu/Debian
sudo apt-get install libqt6gui6 libqt6core6 libqt6widgets6 libxcb-xinerama0

# Fedora/RHEL
sudo dnf install qt6-qtbase-gui

# Arch Linux
sudo pacman -S qt6-base
```

### Ошибка: "wrong ELF class: ELFCLASS32" или "wrong ELF class: ELFCLASS64"

Это означает несовпадение архитектуры. Соберите исполняемый файл на целевой архитектуре или используйте соответствующую виртуальную машину.

### Большой размер исполняемого файла

Это нормально для PyQt6 приложений. Размер обычно составляет 50-100 МБ из-за включения всех библиотек Qt.

## Оптимизация размера

Если нужно уменьшить размер:

1. Используйте UPX для сжатия (уже включено в spec файл)
2. Исключите неиспользуемые модули Qt в `lightcrypto.spec`
3. Используйте `--onefile` режим (уже используется)

## Дополнительные опции

### Добавление иконки

Отредактируйте `lightcrypto.spec` и укажите путь к иконке:
```python
icon='path/to/icon.ico'  # или .png для Linux
```

### Изменение имени исполняемого файла

Отредактируйте `lightcrypto.spec`:
```python
name='lightcrypto-gui',  # вместо 'lightcrypto'
```

## Примечания

- **Платформа:** Исполняемый файл создается для Linux (той же архитектуры, на которой выполняется сборка)
- Исполняемый файл является самодостаточным и не требует установки Python или PyQt6 на целевой системе
- Все зависимости включены в исполняемый файл
- При первом запуске может потребоваться время на распаковку временных файлов
- Для работы на других Linux дистрибутивах могут потребоваться системные библиотеки Qt (см. раздел "Устранение проблем")

## Кроссплатформенная сборка

Для создания исполняемых файлов для других платформ:

- **Windows:** Соберите на Windows машине или используйте WINE (не рекомендуется)
- **macOS:** Соберите на macOS машине
- **Другие архитектуры Linux:** Соберите на целевой архитектуре или используйте Docker/QEMU

