#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö tap-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
# –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ –ª—é–±–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (A –∏–ª–∏ B)

echo "üßπ –û—á–∏—Å—Ç–∫–∞ tap-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."

# –£–±–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "  ‚Üí –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ tap_encrypt –∏ tap_decrypt..."
sudo killall tap_encrypt 2>/dev/null
sudo killall tap_decrypt 2>/dev/null
sleep 1

# –£–¥–∞–ª—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ tap-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
echo "  ‚Üí –£–¥–∞–ª–µ–Ω–∏–µ tap-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤..."
for tap in tap0 tap1 tap2 tap3 tap4 tap5; do
    if ip link show $tap &>/dev/null; then
        sudo ip link delete $tap 2>/dev/null && echo "    ‚úì –£–¥–∞–ª–µ–Ω $tap"
    fi
done

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo ""
echo "üìä –û—Å—Ç–∞–≤—à–∏–µ—Å—è tap-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:"
ip link show | grep -E "^[0-9]+: tap" || echo "  (–Ω–µ—Ç)"

echo ""
echo "üìä –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:"
ps aux | grep -E "tap_encrypt|tap_decrypt" | grep -v grep || echo "  (–Ω–µ—Ç)"

echo ""
echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"

